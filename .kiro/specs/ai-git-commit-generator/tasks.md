# 实现计划

- [x] 1. 初始化VSCode插件项目结构





  - 使用Yeoman生成器创建VSCode插件基础项目
  - 配置TypeScript编译选项和ESLint规则
  - 设置package.json中的插件元数据、激活事件和贡献点
  - 创建基础目录结构：src/services, src/utils, src/types
  - _需求: 1.1, 1.2, 5.1_

- [x] 2. 实现配置管理模块





  - 在package.json中定义配置项（apiEndpoint, apiKey, modelName等）
  - 创建ConfigurationManager类，实现配置读取和验证方法
  - 实现配置验证逻辑，检查必需字段和格式有效性
  - 使用VSCode SecretStorage API安全存储API密钥
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 3. 实现Git服务模块





  - 创建GitService类，封装Git操作
  - 实现检测Git仓库的方法（isGitRepository）
  - 实现获取暂存变更的方法（getStagedChanges），使用VSCode Git API)
  - 实现获取文件diff的方法（getDiff），过滤二进制文件和大文件
  - 实现格式化变更信息的方法，限制diff长度
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 4. 实现LLM服务模块





  - 创建LLMService类，封装API调用逻辑
  - 实现构建提示词的方法（buildPrompt），包含系统提示和用户提示
  - 实现调用OpenAI兼容API的方法（callAPI），使用fetch或axios
  - 实现请求超时机制（30秒）和重试逻辑（最多3次，指数退避）
  - 实现解析API响应并提取提交信息的方法
  - 实现错误处理，区分不同类型的API错误（401, 429, 500等）
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 5. 实现错误处理模块





  - 创建ErrorHandler类，统一错误处理
  - 定义错误类型枚举（ConfigurationError, GitError, APIError等）
  - 实现错误分类方法，根据错误类型返回用户友好的消息
  - 实现错误日志记录方法，使用VSCode输出通道
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 6. 实现UI管理模块






  - 创建UIManager类，封装用户交互
  - 实现显示提交信息输入框的方法（showCommitMessageInput）
  - 实现显示进度指示器的方法（showProgress）
  - 实现显示错误消息的方法（showError），支持操作按钮
  - 实现状态栏消息显示方法（showStatusBarMessage）
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 5.5_

- [x] 7. 实现命令处理器





  - 创建CommandHandler类，协调各模块
  - 实现主命令方法（generateCommitMessage），编排完整流程
  - 实现前置条件验证（validatePrerequisites），检查配置和Git状态
  - 实现进度包装方法（showProgress），在执行任务时显示加载状态
  - 处理用户操作（接受、重新生成、取消）
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 4.3, 4.4, 4.5_

- [x] 8. 实现扩展入口点和命令注册



  - 在extension.ts中实现activate函数
  - 注册命令到VSCode命令面板（aiGitCommit.generateMessage）
  - 初始化所有服务模块实例
  - 创建状态栏项，提供快捷入口
  - 订阅配置变更事件
  - 实现deactivate函数，清理资源
  - _需求: 5.1, 5.2, 5.3, 5.4_
:
- [x] 9. 实现源代码管理集成


  - 在package.json中配置SCM（Source Control Management）贡献点
  - 在源代码管理视图中添加"生成提交信息"按钮
  - 配置按钮图标和工具提示
  - 将按钮命令绑定到generateCommitMessage命令
  - _需求: 5.2_

- [x] 10. 实现键盘快捷键


  - 在package.json中定义键盘快捷键绑定（keybindings）
  - 设置默认快捷键（如Ctrl+Shift+G C）
  - 配置快捷键的上下文条件（仅在Git仓库中可用）
  - _需求: 5.3_

- [x] 11. 优化提示词和提交信息质量


  - 完善系统提示词，明确约定式提交格式要求
  - 实现提交信息后处理，验证格式和长度
  - 添加对多种提交类型的支持（feat, fix, docs等）
  - 实现提交标题长度限制（50-72字符）
  - 根据变更复杂度决定是否生成详细描述
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 12. 实现配置向导


  - 创建首次使用时的配置向导
  - 检测配置缺失时自动触发向导
  - 引导用户输入API端点、密钥和模型名称
  - 验证配置有效性，测试API连接
  - _需求: 1.1, 1.2, 1.3, 1.5, 6.1_

- [x] 13. 添加日志和调试支持


  - 创建输出通道用于日志记录
  - 在关键操作点添加日志（配置加载、Git操作、API调用）
  - 实现不同日志级别（info, warning, error）
  - 确保不记录敏感信息（API密钥）
  - _需求: 6.5_

- [x] 14. 实现diff内容优化


  - 实现diff内容长度限制逻辑
  - 对超长diff进行智能截断或摘要
  - 过滤不相关的diff内容（如package-lock.json）
  - 优化diff格式，使其更适合LLM理解
  - _需求: 2.4, 3.1_

- [x] 15. 添加取消和重试功能



  - 实现API请求的取消机制（使用AbortController）
  - 在UI中提供取消按钮
  - 实现重新生成功能，允许用户获取新的提交信息
  - 处理用户取消操作，清理资源
  - _需求: 3.5, 4.4_

- [x] 16. 完善错误提示和用户引导





  - 为每种错误类型提供具体的解决建议
  - 在配置错误时提供"打开设置"按钮
  - 在API错误时提供"重试"和"查看日志"按钮
  - 在无暂存变更时提供"打开源代码管理"按钮
  - _需求: 6.1, 6.2, 6.3, 6.4_

- [x] 17. 创建README和使用文档





  - 编写README.md，包含功能介绍和安装说明
  - 添加配置指南，说明如何设置OpenAI兼容服务
  - 提供使用示例和截图
  - 添加常见问题解答（FAQ）
  - 列出支持的OpenAI兼容服务（OpenAI, Azure OpenAI, 本地模型等）
  - _需求: 所有需求_

- [x] 18. 添加示例配置和模板





  - 提供不同服务的配置示例（OpenAI, Azure OpenAI, Ollama等）
  - 创建提示词模板文件
  - 提供约定式提交格式的参考文档
  - _需求: 1.1, 1.2, 1.3, 7.3_

- [x] 19. 编写单元测试












  - [x] 19.1 为ConfigurationManager编写测试






    - 测试配置读取、验证和更新功能
    - 测试配置缺失和无效的情况
    --_需求: 1.1, 1.2, 1.3, 1.4, 1.5_
  - [x] 19.2 为GitService编写测试




    - 测试Git:库检测
    - 测试暂存变更获取
    - 测试diff解析和过滤
    --_需求: 2.1, 2.2, 2.3, 2.4, 2.5_
  - [x] 19.3 为LLMService编写测试



    - 测试提示词构建
    - 模拟API调用和响应解析
    - 测试错误处理和重试逻辑
    - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_
  - [x] 19.4 为ErrorHandler编写测试




    - 测试错误分类
    - 测试用户友好消息生成
    - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_


- [x] 20. 编写集成测试




  - [x] 20.1 测试完整的提交信息生成流程









    - 模拟完整的用户操作流程
    - 验证各模块协作正确
    - _需求: 所有需求_
  - [x] 20.2 测试错误场景处理



    - 测试配置错误场景
    - 测试Git错误场景
    - 测试API错误场景
    - _需求: 6.1, 6.2, 6.3, 6.4_

- [x] 21. 打包和发布准备
  - [x] 21.1 优化.vscodeignore文件
    - 确保排除所有开发文件（src/, tests/, .kiro/等）
    - 验证只包含必要的运行时文件
    - _需求: 所有需求_
  - [x] 21.2 创建CHANGELOG.md





    - 记录v0.0.1版本的所有功能
    - 列出已实现的需求和功能特性
    - 添加已知问题和未来计划
    - _需求: 所有需求_
  - [x] 21.3 准备市场资源


    - 创建插件图标（128x128 PNG）
    - 准备功能演示截图或GIF
    - 编写市场描述文本
    - _需求: 所有需求_


  - [x] 21.4 更新package.json发布信息


    - 更新publisher字段为实际发布者名称
    - 添加repository、bugs、homepage等字段
    - 添加icon字段指向插件图标

    - 验证所有必需字段完整
    - _需求: 所有需求_
  - [x] 21.5 安装vsce并打包插件


    - 安装vsce工具：npm install -g @vscode/vsce
    - 运行vsce package生成.vsix文件
    - 测试安装.vsix文件
    - _需求: 所有需求_
  - [x] 21.6 发布前验证


    - 在干净的VSCode环境中测试插件
    - 验证所有功能正常工作
    - 检查插件大小是否合理（<5MB）
    - 确认无敏感信息泄露
    - _需求: 所有需求_