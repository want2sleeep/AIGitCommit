# Changelog

All notable changes to the "AI Git Commit" extension will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### 🔧 Infrastructure

#### 包管理器迁移

- ✅ **迁移到 pnpm**: 从 npm 迁移到 pnpm 包管理器 (需求 1.1-1.5)
  - 使用 pnpm 提升依赖安装速度和磁盘空间利用率
  - 配置 `.npmrc` 实现严格的依赖管理
  - 更新所有脚本使用 pnpm 命令
  - 更新 CI/CD 配置使用 pnpm
  - 在 `package.json` 中指定 `packageManager` 字段

#### 代码质量工具

- ✅ **ESLint 配置增强**: 配置更严格的 ESLint 规则 (需求 10.1)
  - 启用 TypeScript 推荐规则
  - 禁止使用 `any` 类型
  - 要求显式函数返回类型
  - 限制函数复杂度和长度
  
- ✅ **Prettier 集成**: 配置 Prettier 自动格式化代码 (需求 10.2)
  - 统一代码风格（单引号、分号、缩进等）
  - 与 ESLint 集成避免冲突
  - 创建 `.prettierrc` 和 `.prettierignore` 配置文件

- ✅ **Git 钩子**: 使用 Husky 和 lint-staged 配置 pre-commit 钩子 (需求 10.3)
  - 提交前自动运行 ESLint 检查和修复
  - 提交前自动格式化代码
  - 提交前运行测试套件
  - 确保提交的代码符合质量标准

- ✅ **CI/CD 增强**: 更新 GitHub Actions 工作流 (需求 10.4)
  - 使用 pnpm 进行依赖安装
  - 添加代码质量检查步骤
  - 配置测试覆盖率报告
  - 验证构建和打包流程

### 📚 文档

- ✅ **README 更新**: 更新项目文档以反映 pnpm 迁移 (需求 1.4, 9.2)
  - 更新安装说明使用 pnpm
  - 添加 pnpm 安装指南
  - 更新开发指南章节
  - 添加代码质量工具说明
  - 完善开发流程和调试说明

- ✅ **贡献指南**: 创建详细的贡献指南文档 (需求 9.1, 9.2)
  - 添加 `CONTRIBUTING.md` 文件
  - 说明开发环境设置
  - 定义代码规范和提交规范
  - 提供 PR 流程和检查清单
  - 包含测试要求和最佳实践

- ✅ **CHANGELOG 更新**: 记录所有基础设施改进 (需求 9.4)
  - 记录 pnpm 迁移相关变更
  - 记录代码质量工具配置
  - 记录文档更新
  - 保持清晰的版本历史

### 🔄 Breaking Changes

无破坏性变更。所有变更向后兼容。

### 📦 依赖更新

- 新增 `prettier` 用于代码格式化
- 新增 `eslint-config-prettier` 和 `eslint-plugin-prettier` 用于 ESLint 集成
- 新增 `husky` 用于 Git 钩子管理
- 新增 `lint-staged` 用于暂存文件检查
- 指定 `packageManager: pnpm@10.18.1`

### ⚡ 性能优化

- **更快的依赖安装**: pnpm 使用硬链接和符号链接，显著提升安装速度
- **节省磁盘空间**: pnpm 的全局存储机制避免重复下载相同的包
- **严格的依赖管理**: 避免幽灵依赖，提升项目稳定性

### 🎯 开发体验改进

- **自动代码检查**: 提交前自动检查和修复代码问题
- **统一代码风格**: Prettier 确保团队代码风格一致
- **更好的错误提示**: ESLint 提供更详细的错误信息和修复建议
- **完善的文档**: 新贡献者可以快速上手开发

---

## [1.0.0] - 2025-11-14

### 🚀 MVP 发布

- 初步可用（MVP）版本，稳定提供核心能力：
  - 基于 LLM 的提交信息自动生成（支持约定式提交与简单格式）
  - VSCode 集成（命令面板、SCM 按钮、快捷键）
  - 配置面板与安全密钥存储（SecretStorage）
  - OpenAI/Azure OpenAI/Ollama 及其他兼容服务支持

### 📚 文档与配置

- 同步更新 README、示例与市场文案以匹配 1.0.0 状态
- 完善忽略规则，避免将构建产物与内部文档纳入版本库

### 🔧 维护项

- 版本号提升至 1.0.0，标记稳定的 MVP 可用状态
- 保持与既有 0.1.x 系列的向后兼容

---

## [0.1.5] - 2024-11-15

### 🐛 Bug 修复

#### Think 标签过滤

- ✅ **移除 Think 标签**: 修复某些 LLM（如 Claude）在响应中包含 `<think>` 标签导致提交信息不纯净的问题
  - 自动检测并移除所有 `<think>...</think>` 标签块及其内容
  - 支持多行、多个标签块和不规范格式的处理
  - 清理移除标签后产生的多余空白行
  - 快速检测优化：不包含 think 标签时跳过处理

#### 响应验证增强

- ✅ **内容验证**: 增强响应内容验证机制
  - 验证移除 think 标签后内容不为空
  - 提供友好的错误提示，引导用户重新生成
  - 确保提交信息格式符合基本要求

#### 提示词优化

- ✅ **禁止 Think 标签**: 在系统提示词中明确要求 LLM 不使用思考标签
  - 中文提示词添加"不要使用<think>标签或展示思考过程"
  - 英文提示词添加"Do not use <think> tags or show thinking process"
  - 明确要求不包含任何 XML 标签或特殊标记
  - 从源头减少 think 标签出现的可能性

### 🧪 测试覆盖

- ✅ **单元测试**: 完整的测试覆盖
  - 测试正常响应处理（无 think 标签）
  - 测试单个和多个 think 标签块的移除
  - 测试多行内容和不规范格式的处理
  - 测试 think 标签与其他格式混合的情况
  - 测试错误处理（移除后内容为空）

---

## [0.1.0] - 2024-11-15

### 🎉 配置面板增强版本

本版本引入了全新的配置面板和改进的用户体验，使 LLM 服务配置更加直观和便捷。

### ✨ 新增功能

#### 专用配置面板

- ✅ **Webview 配置面板**: 提供专用的可视化配置界面，替代原有的命令行配置向导
- ✅ **实时配置加载**: 打开面板时自动加载当前配置值
- ✅ **配置保存**: 一键保存所有配置项到 VSCode 设置和安全存储
- ✅ **配置验证**: 保存前自动验证配置完整性和有效性
- ✅ **友好表单**: 清晰的表单布局，包含字段说明和验证提示
- ✅ **主题适配**: 自动适配 VSCode 主题（深色/浅色模式）

#### API 提供商选择器

- ✅ **下拉选择器**: 提供 API 提供商下拉选择器，支持快速选择常用服务
- ✅ **预定义提供商**: 内置 OpenAI、Azure OpenAI、Ollama 和自定义选项
- ✅ **自动填充**: 选择提供商时自动填充推荐的 Base URL 和模型名称
- ✅ **自定义支持**: 支持自定义 OpenAI 兼容服务配置
- ✅ **提供商管理**: 新增 ProviderManager 模块管理提供商配置

#### 源代码管理视图增强

- ✅ **SCM 按钮集成**: 在源代码管理视图标题栏添加生成按钮，作为首选操作入口
- ✅ **悬停提示**: 鼠标悬停在生成按钮上时显示当前配置摘要
- ✅ **配置信息显示**: 悬停提示中显示 API 提供商、Base URL、模型名称等信息
- ✅ **API 密钥遮蔽**: 在悬停提示中安全显示 API 密钥（部分遮蔽）
- ✅ **未配置提示**: 配置不完整时显示友好的提示信息

---

## [0.0.1] - 2024-11-14

### 🎉 Initial Release

首个版本发布，实现了基于 AI 的 Git 提交信息自动生成功能。

### ✨ Features

#### 核心功能

- **AI 驱动的提交信息生成**: 使用大语言模型智能分析代码变更并生成专业的提交信息
- **OpenAI 兼容 API 支持**: 支持所有 OpenAI 兼容的 LLM 服务（OpenAI、Azure OpenAI、Ollama、LocalAI 等）
- **约定式提交格式**: 自动生成符合 Conventional Commits 规范的提交信息
- **多语言支持**: 支持中文和英文提交信息生成

#### 配置管理

- ✅ **API 配置界面**: 提供完整的配置界面用于设置 API 端点、密钥和模型名称
- ✅ **安全存储**: API 密钥安全存储在 VSCode SecretStorage 中
- ✅ **配置验证**: 自动验证配置的有效性和完整性
- ✅ **配置向导**: 首次使用时自动引导用户完成配置
- ✅ **配置迁移**: 自动将旧版本的明文 API 密钥迁移到安全存储

#### Git 集成

- ✅ **Git 仓库检测**: 自动检测当前工作区是否为 Git 仓库
- ✅ **暂存变更获取**: 获取暂存区的文件变更列表和详细差异
- ✅ **智能过滤**: 自动过滤二进制文件和大文件的差异内容
- ✅ **变更验证**: 在无暂存变更时提示用户先暂存变更
- ✅ **Diff 优化**: 智能截断和格式化 diff 内容，避免超出 LLM 上下文限制

#### LLM 服务调用

- ✅ **提示词构建**: 将 Git 差异内容格式化为 LLM 可理解的提示词
- ✅ **API 调用**: 使用配置的 API 信息调用 OpenAI 兼容的 LLM 服务
- ✅ **加载状态**: 在调用 LLM 时显示进度指示器
- ✅ **响应解析**: 解析并提取 LLM 生成的提交信息
- ✅ **错误处理**: 完善的 API 错误处理和重试机制
- ✅ **请求超时**: 30 秒超时机制，防止长时间等待
- ✅ **自动重试**: 失败时自动重试最多 3 次，使用指数退避策略
- ✅ **取消支持**: 支持取消正在进行的 API 请求

---

**[0.0.1]**: 2024-11-14
